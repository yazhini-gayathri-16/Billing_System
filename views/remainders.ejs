<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upcoming Appointments - Salon Dashboard</title>
    <link rel="icon" href="/images/logo 3-square.png" type="image/x-icon">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Gowun+Batang&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/styles/navbarstyle.css">
    <link rel="stylesheet" href="/styles/headerstyle.css">
    <style>
        body {
            font-family: 'Gowun Batang', serif;
            background-color: #D3E4CD;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        .page-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px;
        }

        /* Page Header */
        .page-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .page-header h1 {
            font-size: 32px;
            font-weight: 700;
            color: #1a202c;
            margin: 0 0 12px 0;
        }

        .month-display {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 16px;
            color: #4a5568;
        }

        .month-display i {
            color: #718096;
        }

        /* Date Selector */
        .date-selector {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin: 40px 0;
            flex-wrap: wrap;
        }

        .date-card {
            width: 70px;
            padding: 14px 12px;
            background: #f0f4f0;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .date-card:hover {
            background: #e8ece8;
        }

        .date-card.active {
            background: #3b82f6;
            border-color: #3b82f6;
        }

        .date-card .day-name {
            font-size: 12px;
            font-weight: 500;
            color: #718096;
            margin: 0 0 6px 0;
            text-transform: capitalize;
        }

        .date-card.active .day-name {
            color: rgba(255, 255, 255, 0.8);
        }

        .date-card .day-number {
            font-size: 20px;
            font-weight: 700;
            color: #1a202c;
            margin: 0;
        }

        .date-card.active .day-number {
            color: white;
        }

        /* Appointments Grid */
        .appointments-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 24px;
            justify-content: center;
            margin-top: 30px;
        }

        /* Appointment Card */
        .appointment-card {
            background: #F5F5DC;
            border-radius: 20px;
            padding: 24px;
            width: 180px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            position: relative;
        }

        .appointment-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
        }

        .avatar-container {
            position: relative;
            display: inline-block;
            margin-bottom: 16px;
        }

        .appointment-avatar {
            width: 90px;
            height: 90px;
            border-radius: 16px;
            object-fit: cover;
            background: linear-gradient(135deg, #fce4ec 0%, #f8bbd9 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .appointment-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .appointment-avatar i {
            font-size: 36px;
            color: #e57373;
        }

        .status-dot {
            position: absolute;
            bottom: 0;
            right: -4px;
            width: 14px;
            height: 14px;
            background: #4CAF50;
            border-radius: 50%;
            border: 3px solid #F5F5DC;
        }

        .appointment-name {
            font-size: 16px;
            font-weight: 700;
            color: #1a202c;
            margin: 0 0 4px 0;
        }

        .appointment-service {
            font-size: 12px;
            font-weight: 600;
            color: #718096;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin: 0 0 16px 0;
        }

        .appointment-time {
            display: inline-block;
            padding: 8px 16px;
            background: white;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            color: #4a5568;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
        }

        /* Book Appointment Card */
        .book-card {
            background: rgba(76, 175, 80, 0.08);
            border: 2px dashed #a8d5ab;
            border-radius: 20px;
            padding: 24px;
            width: 180px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 200px;
        }

        .book-card:hover {
            background: rgba(76, 175, 80, 0.12);
            border-color: #4CAF50;
        }

        .book-card .plus-icon {
            width: 50px;
            height: 50px;
            background: rgba(76, 175, 80, 0.15);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
        }

        .book-card .plus-icon i {
            font-size: 20px;
            color: #4CAF50;
        }

        .book-card p {
            font-size: 14px;
            font-weight: 600;
            color: #4a5568;
            margin: 0;
        }

        /* No Appointments */
        .no-appointments {
            text-align: center;
            padding: 60px 20px;
            color: #718096;
        }

        .no-appointments i {
            font-size: 48px;
            color: #a0aec0;
            margin-bottom: 16px;
        }

        .no-appointments h3 {
            font-size: 18px;
            font-weight: 600;
            color: #4a5568;
            margin: 0 0 8px 0;
        }

        .no-appointments p {
            font-size: 14px;
            margin: 0;
        }

        /* Loading State */
        .loading-state {
            text-align: center;
            padding: 60px 20px;
            color: #718096;
        }

        .loading-state i {
            font-size: 32px;
            color: #4CAF50;
            margin-bottom: 12px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .page-container {
                padding: 20px;
            }

            .date-selector {
                gap: 8px;
            }

            .date-card {
                width: 55px;
                padding: 10px 8px;
            }

            .date-card .day-number {
                font-size: 16px;
            }

            .appointments-grid {
                gap: 16px;
            }

            .appointment-card,
            .book-card {
                width: 150px;
                padding: 20px;
            }

            .appointment-avatar {
                width: 70px;
                height: 70px;
            }
        }
    </style>
</head>
<body>
    <%- include('partials/navbar') %>
    <%- include('partials/second_navbar') %>

    <div class="page-container">
        <!-- Page Header -->
        <div class="page-header">
            <h1>Upcoming Appointments</h1>
            <div class="month-display">
                <i class="far fa-calendar-alt"></i>
                <span id="currentMonth"></span>
            </div>
        </div>

        <!-- Date Selector -->
        <div class="date-selector" id="dateSelector">
            <!-- Date cards will be dynamically generated here -->
        </div>

        <!-- Appointments Grid -->
        <div class="appointments-grid" id="appointmentsList">
            <div class="loading-state">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Loading appointments...</p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            generateDateCards();
            fetchAppointmentsForDate(getTodayDateString());
        });

        function getTodayDateString() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function generateDateCards() {
            const dateSelector = document.getElementById('dateSelector');
            const currentMonth = document.getElementById('currentMonth');
            const today = new Date();

            // Display current month
            const monthOptions = { month: 'long', year: 'numeric' };
            currentMonth.innerText = today.toLocaleDateString('en-US', monthOptions);

            // Generate date cards for the next 7 days
            dateSelector.innerHTML = '';
            for (let i = 0; i < 7; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() + i);

                const dateCard = document.createElement('div');
                dateCard.className = 'date-card';

                const dayOfWeek = date.toLocaleDateString('en-US', { weekday: 'short' });
                const dateOfMonth = date.getDate();

                dateCard.innerHTML = `
                    <p class="day-name">${dayOfWeek}</p>
                    <p class="day-number">${dateOfMonth}</p>
                `;

                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                const localDateString = `${year}-${month}-${day}`;
                dateCard.dataset.date = localDateString;

                dateCard.addEventListener('click', () => {
                    document.querySelectorAll('.date-card').forEach(card => card.classList.remove('active'));
                    dateCard.classList.add('active');
                    fetchAppointmentsForDate(localDateString);
                });

                dateSelector.appendChild(dateCard);

                // Mark today as active (3rd day from start, as shown in screenshot with Tuesday)
                if (i === 0) {
                    dateCard.classList.add('active');
                }
            }
        }

        async function fetchAppointmentsForDate(date) {
            const appointmentsList = document.getElementById('appointmentsList');
            
            // Show loading state
            appointmentsList.innerHTML = `
                <div class="loading-state">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Loading appointments...</p>
                </div>
            `;

            try {
                const response = await fetch(`/appointments/${date}`);
                const appointments = await response.json();
                appointmentsList.innerHTML = '';

                if (appointments.length === 0) {
                    appointmentsList.innerHTML = `
                        <div class="no-appointments">
                            <i class="far fa-calendar-times"></i>
                            <h3>No appointments scheduled</h3>
                            <p>Book a new appointment to get started</p>
                        </div>
                    `;
                    
                    // Add the book appointment card
                    const bookCard = document.createElement('div');
                    bookCard.className = 'book-card';
                    bookCard.onclick = () => window.location.href = '/appointment';
                    bookCard.innerHTML = `
                        <div class="plus-icon">
                            <i class="fas fa-plus"></i>
                        </div>
                        <p>Book Appointment</p>
                    `;
                    appointmentsList.appendChild(bookCard);
                } else {
                    // Service images mapping
                    const serviceImages = {
                        'facial': '/images/facial.png',
                        'haircut': '/images/haircut.png',
                        'massage': '/images/massage.png',
                        'manicure': '/images/manicure.png',
                        'pedicure': '/images/pedicure.png',
                        'default': '/images/shampoo.png'
                    };

                    appointments.forEach(appointment => {
                        const appointmentCard = document.createElement('div');
                        appointmentCard.className = 'appointment-card';

                        const appointmentDate = new Date(appointment.dateTime);
                        let hours = appointmentDate.getUTCHours();
                        const minutes = appointmentDate.getUTCMinutes().toString().padStart(2, '0');
                        const period = hours >= 12 ? 'p.m.' : 'a.m.';
                        hours = hours % 12 || 12;
                        const formattedTime = `${hours}:${minutes} ${period}`;

                        // Get service image
                        const serviceKey = appointment.serviceType.toLowerCase();
                        const serviceImage = serviceImages[serviceKey] || serviceImages['default'];

                        appointmentCard.innerHTML = `
                            <div class="avatar-container">
                                <div class="appointment-avatar">
                                    <img src="${serviceImage}" alt="${appointment.serviceType}" onerror="this.style.display='none'; this.parentNode.innerHTML='<i class=\\'fas fa-spa\\'></i>';">
                                </div>
                                <span class="status-dot"></span>
                            </div>
                            <h3 class="appointment-name">${appointment.customerName}</h3>
                            <p class="appointment-service">${appointment.serviceType}</p>
                            <span class="appointment-time">${formattedTime}</span>
                        `;
                        appointmentsList.appendChild(appointmentCard);
                    });

                    // Add the book appointment card at the end
                    const bookCard = document.createElement('div');
                    bookCard.className = 'book-card';
                    bookCard.onclick = () => window.location.href = '/appointment';
                    bookCard.innerHTML = `
                        <div class="plus-icon">
                            <i class="fas fa-plus"></i>
                        </div>
                        <p>Book Appointment</p>
                    `;
                    appointmentsList.appendChild(bookCard);
                }
            } catch (error) {
                console.error("Error fetching appointments:", error);
                appointmentsList.innerHTML = `
                    <div class="no-appointments">
                        <i class="fas fa-exclamation-circle"></i>
                        <h3>Error loading appointments</h3>
                        <p>Please try again later</p>
                    </div>
                `;
            }
        }
    </script>
    <%- include('partials/globalScripts') %>
</body>
</html>
