<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory Management</title>
    <link rel="icon" href="/images/logo 3-square.png" type="image/x-icon">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Gowun+Batang&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/styles/navbarstyle.css">
    <link rel="stylesheet" href="/styles/headerstyle.css">
    <style>
        body {
            font-family: 'Gowun Batang', serif;
            background-color: #D3E4CD;
            margin: 0;
            padding: 0;
        }

        .page-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 15px 20px;
        }

        /* Page Header */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .header-left h1 {
            font-size: 28px;
            font-weight: 700;
            color: #1a202c;
            margin: 0 0 6px 0;
        }

        .header-left p {
            font-size: 14px;
            color: #718096;
            margin: 0;
        }

        .header-stats {
            display: flex;
            gap: 16px;
        }

        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 16px 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            min-width: 140px;
        }

        .stat-card-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .stat-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .stat-icon.blue {
            background: #dbeafe;
            color: #1e40af;
        }

        .stat-icon.red {
            background: #fee2e2;
            color: #dc2626;
        }

        .stat-label {
            font-size: 11px;
            font-weight: 600;
            color: #718096;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-value {
            font-size: 26px;
            font-weight: 700;
            color: #1a202c;
        }

        /* Add New Product Section */
        .add-product-section {
            background: #F5F5DC;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .add-product-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 16px;
        }

        .add-product-header i {
            color: #4CAF50;
            font-size: 18px;
        }

        .add-product-header h2 {
            font-size: 16px;
            font-weight: 600;
            color: #1a202c;
            margin: 0;
        }

        .product-form {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr auto;
            gap: 16px;
            align-items: end;
        }

        .form-group {
            min-width: 0;
        }

        .form-group label {
            display: block;
            font-size: 12px;
            font-weight: 500;
            color: #4a5568;
            margin-bottom: 6px;
        }

        .form-group input {
            width: 100%;
            padding: 10px 14px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
            font-family: 'Gowun Batang', serif;
            transition: all 0.2s;
            box-sizing: border-box;
        }

        .form-group input:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }

        .btn-add-item {
            padding: 11px 24px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .btn-add-item:hover {
            background: #45a049;
        }

        /* Current Inventory Section */
        .inventory-section {
            background: #F5F5DC;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .inventory-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .inventory-header-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .inventory-header-left i {
            color: #4a5568;
            font-size: 18px;
        }

        .inventory-header-left h2 {
            font-size: 18px;
            font-weight: 600;
            color: #1a202c;
            margin: 0;
        }

        .search-filter-container {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .search-box {
            position: relative;
            width: 300px;
        }

        .search-box input {
            width: 100%;
            padding: 8px 12px 8px 36px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 13px;
            transition: all 0.2s;
        }

        .search-box input:focus {
            outline: none;
            border-color: #cbd5e0;
        }

        .search-box i {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #a0aec0;
            font-size: 14px;
        }

        .filter-icon {
            width: 36px;
            height: 36px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-icon:hover {
            background: white;
        }

        /* Product Cards Grid */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .product-card {
            background: #F0F8E2;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            position: relative;
            transition: all 0.3s;
        }

        .product-card:hover {
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }

        .product-icon {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            margin-bottom: 16px;
        }

        .product-icon.purple { background: #f3e8ff; color: #7c3aed; }
        .product-icon.teal { background: #ccfbf1; color: #0d9488; }
        .product-icon.pink { background: #fce7f3; color: #db2777; }
        .product-icon.orange { background: #fed7aa; color: #ea580c; }
        .product-icon.blue { background: #dbeafe; color: #2563eb; }
        .product-icon.green { background: #d1fae5; color: #059669; }

        .product-name {
            font-size: 16px;
            font-weight: 600;
            color: #1a202c;
            margin-bottom: 16px;
        }

        .product-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 16px;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
        }

        .detail-label {
            font-size: 11px;
            font-weight: 600;
            color: #718096;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .detail-value {
            font-size: 15px;
            font-weight: 600;
            color: #1a202c;
        }

        .inventory-status {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 12px;
            background: white;
            border-radius: 6px;
            margin-bottom: 16px;
        }

        .inventory-status .detail-label {
            margin-bottom: 0;
        }

        .status-value {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            font-weight: 600;
        }

        .status-value.high { color: #16a34a; }
        .status-value.medium { color: #ca8a04; }
        .status-value.low { color: #ea580c; }

        .status-value i {
            font-size: 12px;
        }

        .product-actions {
            display: flex;
            gap: 10px;
        }

        .btn-edit {
            flex: 1;
            padding: 10px;
            background: white;
            color: #4a5568;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-edit:hover {
            background: #f7fafc;
            border-color: #cbd5e0;
        }

        .btn-delete {
            width: 40px;
            height: 40px;
            background: white;
            color: #DC3545;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-delete:hover {
            background: #fef2f2;
            border-color: #fca5a5;
        }

        /* Edit Mode Styles */
        .product-card.editing {
            background: #fffbeb;
            border: 2px solid #fbbf24;
        }

        .product-card.editing input {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            font-size: 14px;
            margin-top: 4px;
        }

        .product-card.editing .btn-save {
            background: #4CAF50;
            color: white;
            border: none;
        }

        .product-card.editing .btn-save:hover {
            background: #45a049;
        }

        .product-card.editing .btn-cancel {
            background: #6c757d;
            color: white;
            border: none;
        }

        .product-card.editing .btn-cancel:hover {
            background: #5a6268;
        }

        /* Delete Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
            text-align: center;
            min-width: 400px;
        }

        .modal-icon {
            width: 56px;
            height: 56px;
            background: #fee2e2;
            color: #DC3545;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 16px;
            font-size: 24px;
        }

        .modal-content h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #1a202c;
        }

        .modal-content p {
            font-size: 14px;
            color: #718096;
            margin-bottom: 24px;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .modal-btn {
            padding: 10px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .modal-btn.cancel {
            background: #f3f4f6;
            color: #4b5563;
        }

        .modal-btn.cancel:hover {
            background: #e5e7eb;
        }

        .modal-btn.confirm {
            background: #DC3545;
            color: white;
        }

        .modal-btn.confirm:hover {
            background: #c82333;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .page-header {
                flex-direction: column;
                gap: 16px;
            }

            .product-form {
                grid-template-columns: 1fr;
            }

            .search-box {
                width: 100%;
            }

            .products-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <% if (userRole === 'admin') { %>
        <%- include('partials/navbar') %>
    <% } else { %>
        <%- include('partials/staffnavbar') %>
    <% } %>

    <div class="page-container">
        <!-- Page Header -->
        <div class="page-header">
            <div class="header-left">
                <h1>Inventory Management</h1>
                <p>Track stock levels, purchases, and product details efficiently.</p>
            </div>
            <div class="header-stats">
                <div class="stat-card">
                    <div class="stat-card-header">
                        <div class="stat-icon blue">
                            <i class="fas fa-box"></i>
                        </div>
                        <span class="stat-label">Total Items</span>
                    </div>
                    <div class="stat-value"><%= products.length %></div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-header">
                        <div class="stat-icon red">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <span class="stat-label">Low Stock</span>
                    </div>
                    <div class="stat-value"><%= products.filter(p => p.stocksInInventory < 10).length %></div>
                </div>
            </div>
        </div>

        <!-- Add New Product Section -->
        <div class="add-product-section">
            <div class="add-product-header">
                <i class="fas fa-plus-circle"></i>
                <h2>Add New Product</h2>
            </div>
            <form action="/inventory" method="post" class="product-form">
                <div class="form-group">
                    <label>Product Name</label>
                    <input type="text" name="productName" placeholder="e.g. Keratin Shampoo" autocomplete="off" required>
                </div>
                <div class="form-group">
                    <label>Price (₹)</label>
                    <input type="number" name="productPrice" placeholder="0.00" step="0.01" required>
                </div>
                <div class="form-group">
                    <label>Purchased Qty</label>
                    <input type="number" name="stocksPurchased" placeholder="0" required>
                </div>
                <div class="form-group">
                    <label>In Inventory</label>
                    <input type="number" name="stocksInInventory" placeholder="0" required>
                </div>
                <button type="submit" class="btn-add-item">
                    <i class="fas fa-plus"></i>
                    Add Item
                </button>
            </form>
        </div>

        <!-- Current Inventory Section -->
        <div class="inventory-section">
            <div class="inventory-header">
                <div class="inventory-header-left">
                    <i class="fas fa-th-list"></i>
                    <h2>Current Inventory</h2>
                </div>
                <div class="search-filter-container">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchInput" placeholder="Search products..." onkeyup="searchProducts()">
                    </div>
                    <div class="filter-icon">
                        <i class="fas fa-filter"></i>
                    </div>
                </div>
            </div>

            <div class="products-grid">
                <% 
                const iconColors = ['purple', 'teal', 'pink', 'orange', 'blue', 'green'];
                const icons = ['fa-spray-can', 'fa-pump-soap', 'fa-flask', 'fa-spray-can-sparkles', 'fa-droplet', 'fa-bottle-droplet'];
                
                products.forEach(function(product, index) { 
                    const iconColor = iconColors[index % iconColors.length];
                    const icon = icons[index % icons.length];
                    
                    // Determine stock status
                    let stockStatus = 'high';
                    let stockIcon = 'fa-check-circle';
                    if (product.stocksInInventory < 10) {
                        stockStatus = 'low';
                        stockIcon = 'fa-exclamation-triangle';
                    } else if (product.stocksInInventory < 20) {
                        stockStatus = 'medium';
                        stockIcon = 'fa-exclamation-circle';
                    }
                %>
                <div class="product-card" id="product-card-<%= index %>" data-product-name="<%= product.productName.toLowerCase() %>">
                    <div class="product-icon <%= iconColor %>">
                        <i class="fas <%= icon %>"></i>
                    </div>
                    
                    <div class="product-name editable" data-field="productName"><%= product.productName %></div>
                    
                    <div class="product-details">
                        <div class="detail-item">
                            <span class="detail-label">Price</span>
                            <span class="detail-value editable" data-field="productPrice">₹<%= product.productPrice %></span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Purchased</span>
                            <span class="detail-value editable" data-field="stocksPurchased"><%= product.stocksPurchased %> Units</span>
                        </div>
                    </div>
                    
                    <div class="inventory-status">
                        <span class="detail-label">In Inventory</span>
                        <span class="status-value <%= stockStatus %> editable" data-field="stocksInInventory">
                            <i class="fas <%= stockIcon %>"></i>
                            <%= product.stocksInInventory %> Units
                        </span>
                    </div>
                    
                    <form id="edit-form-<%= index %>" action="/edit-item" method="post" style="display: none;">
                        <input type="hidden" name="id" value="<%= product._id %>">
                        <input type="hidden" name="productName" id="input-productName-<%= index %>">
                        <input type="hidden" name="productPrice" id="input-productPrice-<%= index %>">
                        <input type="hidden" name="stocksPurchased" id="input-stocksPurchased-<%= index %>">
                        <input type="hidden" name="stocksInInventory" id="input-stocksInInventory-<%= index %>">
                    </form>
                    
                    <div class="product-actions">
                        <button class="btn-edit" onclick="toggleEdit(<%= index %>, '<%= product.productName %>', <%= product.productPrice %>, <%= product.stocksPurchased %>, <%= product.stocksInInventory %>)">Edit Details</button>
                        <button class="btn-delete" onclick="confirmDelete('<%= product._id %>')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                <% }); %>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteConfirmModal" class="modal">
        <div class="modal-content">
            <div class="modal-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <h3>Delete Product?</h3>
            <p>Are you sure you want to delete this product?<br>This action cannot be undone.</p>
            <form id="deleteForm" action="/delete-item" method="post">
                <input type="hidden" name="id" id="deleteProductId">
                <div class="modal-actions">
                    <button type="button" class="modal-btn cancel" onclick="closeDeleteModal()">Cancel</button>
                    <button type="submit" class="modal-btn confirm">Delete</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Search functionality
        function searchProducts() {
            const input = document.getElementById('searchInput');
            const filter = input.value.toLowerCase();
            const cards = document.querySelectorAll('.product-card');

            cards.forEach(card => {
                const productName = card.getAttribute('data-product-name');
                if (productName.indexOf(filter) > -1) {
                    card.style.display = '';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // Store original values
        const originalValues = {};

        // Toggle edit mode
        function toggleEdit(index, productName, productPrice, stocksPurchased, stocksInInventory) {
            const card = document.getElementById('product-card-' + index);
            const isEditing = card.classList.contains('editing');

            if (isEditing) {
                // Cancel edit mode
                card.classList.remove('editing');
                
                // Restore original values
                const editables = card.querySelectorAll('.editable');
                editables.forEach(el => {
                    const field = el.getAttribute('data-field');
                    if (originalValues[index] && originalValues[index][field]) {
                        el.innerHTML = originalValues[index][field];
                    }
                });
                
                // Change button back
                const btn = card.querySelector('.btn-edit');
                btn.textContent = 'Edit Details';
                btn.onclick = function() { toggleEdit(index, productName, productPrice, stocksPurchased, stocksInInventory); };
            } else {
                // Enter edit mode
                card.classList.add('editing');
                
                // Store original values
                originalValues[index] = {
                    productName: productName,
                    productPrice: '₹' + productPrice,
                    stocksPurchased: stocksPurchased + ' Units',
                    stocksInInventory: card.querySelector('[data-field="stocksInInventory"]').innerHTML
                };
                
                // Replace with input fields
                const nameEl = card.querySelector('[data-field="productName"]');
                nameEl.innerHTML = '<input type="text" value="' + productName + '" id="edit-productName-' + index + '">';
                
                const priceEl = card.querySelector('[data-field="productPrice"]');
                priceEl.innerHTML = '₹<input type="number" value="' + productPrice + '" id="edit-productPrice-' + index + '" step="0.01" style="width: 80px;">';
                
                const purchasedEl = card.querySelector('[data-field="stocksPurchased"]');
                purchasedEl.innerHTML = '<input type="number" value="' + stocksPurchased + '" id="edit-stocksPurchased-' + index + '" style="width: 60px;"> Units';
                
                const inventoryEl = card.querySelector('[data-field="stocksInInventory"]');
                const inventoryValue = stocksInInventory;
                inventoryEl.innerHTML = '<i class="fas fa-exclamation-triangle"></i><input type="number" value="' + inventoryValue + '" id="edit-stocksInInventory-' + index + '" style="width: 60px;"> Units';
                
                // Change buttons
                const actionsDiv = card.querySelector('.product-actions');
                actionsDiv.innerHTML = `
                    <button class="btn-edit btn-save" onclick="saveEdit(${index})">Save Changes</button>
                    <button class="btn-edit btn-cancel" onclick="toggleEdit(${index}, '${productName}', ${productPrice}, ${stocksPurchased}, ${stocksInInventory})">Cancel</button>
                `;
            }
        }

        // Save edit
        function saveEdit(index) {
            const productName = document.getElementById('edit-productName-' + index).value;
            const productPrice = document.getElementById('edit-productPrice-' + index).value;
            const stocksPurchased = document.getElementById('edit-stocksPurchased-' + index).value;
            const stocksInInventory = document.getElementById('edit-stocksInInventory-' + index).value;

            // Set hidden form values
            document.getElementById('input-productName-' + index).value = productName;
            document.getElementById('input-productPrice-' + index).value = productPrice;
            document.getElementById('input-stocksPurchased-' + index).value = stocksPurchased;
            document.getElementById('input-stocksInInventory-' + index).value = stocksInInventory;

            // Submit form
            document.getElementById('edit-form-' + index).submit();
        }

        // Delete confirmation
        function confirmDelete(productId) {
            document.getElementById('deleteProductId').value = productId;
            document.getElementById('deleteConfirmModal').style.display = 'flex';
        }

        function closeDeleteModal() {
            document.getElementById('deleteConfirmModal').style.display = 'none';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('deleteConfirmModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        };
    </script>
    <%- include('partials/globalScripts') %>
</body>
</html>
